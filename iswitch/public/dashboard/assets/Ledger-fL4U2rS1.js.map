{"version":3,"file":"Ledger-fL4U2rS1.js","sources":["../../../../Merchant/src/pages/Ledger.vue"],"sourcesContent":["<template>\n  <div class=\"space-y-6\">\n    <div class=\"flex items-center justify-between\">\n      <div>\n        <h1 class=\"text-3xl font-bold tracking-tight text-foreground\">Ledger</h1>\n        <p class=\"text-muted-foreground mt-1\">View and manage your financial transactions.</p>\n      </div>\n      <button class=\"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2\" @click=\"exportLedger\">\n        <svg class=\"mr-2 h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\" />\n          <polyline points=\"7 10 12 15 17 10\" />\n          <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\" />\n        </svg>\n        Export\n      </button>\n    </div>\n\n    <!-- Filters -->\n    <div class=\"rounded-xl border bg-card text-card-foreground shadow-sm p-6 mb-6\">\n      <h3 class=\"text-lg font-semibold mb-4\">Filters</h3>\n      <div class=\"flex flex-wrap items-end gap-4\">\n        <div class=\"flex-1 min-w-[200px]\">\n          <label class=\"block text-sm font-medium text-muted-foreground mb-2\">TRANSACTION TYPE</label>\n          <select v-model=\"filters.type\" class=\"w-full h-10 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\">\n            <option value=\"\">All Types</option>\n            <option value=\"Credit\">Credit</option>\n            <option value=\"Debit\">Debit</option>\n          </select>\n        </div>\n\n        <div class=\"flex-1 min-w-[200px]\">\n          <label class=\"block text-sm font-medium text-muted-foreground mb-2\">FROM DATE & TIME</label>\n          <input \n            type=\"datetime-local\" \n            v-model=\"filters.fromDate\" \n            class=\"w-full h-10 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\n          />\n        </div>\n\n        <div class=\"flex-1 min-w-[200px]\">\n          <label class=\"block text-sm font-medium text-muted-foreground mb-2\">TO DATE & TIME</label>\n          <input \n            type=\"datetime-local\" \n            v-model=\"filters.toDate\" \n            class=\"w-full h-10 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\n          />\n        </div>\n\n        <button \n          class=\"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-6\"\n          @click=\"applyFilters\"\n        >\n          Apply Filters\n        </button>\n      </div>\n    </div>\n\n    <!-- Table -->\n    <div class=\"rounded-xl border bg-card text-card-foreground shadow-sm overflow-hidden\">\n      <DataTable\n        :columns=\"ledgerColumns\"\n        :data=\"ledgerData\"\n        :per-page=\"10\"\n      >\n        <template #cell-status=\"{ value }\">\n          <span \n            class=\"inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\"\n            :class=\"{\n              'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300': value === 'success',\n              'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300': value === 'processing',\n              'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300': value === 'failed'\n            }\"\n          >\n            {{ value.charAt(0).toUpperCase() + value.slice(1) }}\n          </span>\n        </template>\n      </DataTable>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport DataTable from '@/components/DataTable.vue'\nimport { call } from 'frappe-ui'\n\n// Filters\nconst filters = ref({\n  type: '',\n  fromDate: '',\n  toDate: ''\n})\n\nconst ledgerColumns = [\n  { key: 'id', label: 'Ledger ID', sortable: true },\n  { key: 'order_id', label: 'Order ID', sortable: true },\n  { key: 'type', label: 'Transaction Type', type: 'badge', sortable: true },\n  { key: 'transaction_amount', label: 'Transaction Amount', type: 'currency', sortable: true },\n  { key: 'opening_balance', label: 'Opening Balance', type: 'currency', sortable: true },\n  { key: 'closing_balance', label: 'Closing Balance', type: 'currency', sortable: true },\n  { key: 'date', label: 'Date', type: 'datetime', sortable: true }\n]\n\nconst ledgerData = ref([])\nconst loading = ref(false)\n\n// Fetch ledger entries from API\nconst fetchLedger = async () => {\n  loading.value = true\n  try {\n    const filterData = {\n      type: filters.value.type || null,\n      from_date: filters.value.fromDate || null,\n      to_date: filters.value.toDate || null\n    }\n\n    const response = await call('iswitch.merchant_portal_api.get_ledger_entries', {\n      filter_data: JSON.stringify(filterData),\n      page: 1,\n      page_size: 50\n    })\n    \n    // Frappe wraps response in 'message' object\n    const data = response?.message || response\n    \n    if (data && data.entries) {\n      ledgerData.value = data.entries.map(entry => ({\n        id: entry.id,\n        order_id: entry.order_id || '-',\n        type: entry.type.toLowerCase(),\n        transaction_amount: parseFloat(entry.transaction_amount || 0),\n        opening_balance: parseFloat(entry.opening_balance || 0),\n        closing_balance: parseFloat(entry.closing_balance || 0),\n        date: entry.date\n      }))\n    }\n  } catch (error) {\n    console.error('Error fetching ledger:', error)\n    ledgerData.value = []\n  } finally {\n    loading.value = false\n  }\n}\n\nconst applyFilters = () => {\n  fetchLedger()\n}\n\nconst exportLedger = async () => {\n  try {\n    const filterData = {\n      type: filters.value.type || null,\n      from_date: filters.value.fromDate || null,\n      to_date: filters.value.toDate || null\n    }\n    \n    const queryParams = new URLSearchParams({\n      filters: JSON.stringify(filterData)\n    }).toString()\n    \n    window.location.href = `/api/method/iswitch.merchant_portal_api.export_ledger_to_excel?${queryParams}`\n  } catch (error) {\n    console.error('Error exporting ledger:', error)\n  }\n}\n\n// Fetch ledger when component mounts\nonMounted(() => {\n  fetchLedger()\n})\n\nconst viewEntry = (entry) => {\n  console.log('Viewing entry:', entry)\n}\n</script>\n\n<style scoped>\n.space-y-6 > * + * {\n  margin-top: 1.5rem;\n}\n</style>\n"],"names":["filters","ref","ledgerColumns","ledgerData","loading","fetchLedger","__async","filterData","response","call","data","entry","error","applyFilters","exportLedger","queryParams","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_cache","_hoisted_3","_hoisted_4","$event","_vModelSelect","_hoisted_5","_vModelText","_hoisted_6","_hoisted_7","_createVNode","DataTable","_withCtx","value","_toDisplayString"],"mappings":"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"}